{% extends "base.html" %}
{% load static %}

{% block title %} Yuva Bildir {% endblock %}

{% block content %} 

<div class="container mt-3">
   <div class=" col-md-8 offset-md-2 ">
      <h1>Yuva bildir</h1>
      <hr>
      <form method="POST" name="form2" onsubmit="return validateForm()">
         {% csrf_token %}
         <div class="row mt-3">
            <div class="col">
               <label for="il" class="form-label">İl</label>
               <input id='il' type="text" name="il" placeholder="İl girin" class="form-control">
            </div>
            <div class="col">
               <label for="ilce" class="form-label">İlçe</label>
               <input id='ilce' type="text" name="ilce" placeholder="İlçe girin" class="form-control">
            </div>
         </div>
         <div class="row mt-3 mb-4">
            <div class="col">
               <label for="mahalle" class="form-label">Mahalle</label>
               <input id='mahalle' type="text" name="mahalle" placeholder="Mahalle girin" class="form-control">
            </div>
            <div class="col">
               <label for="sokak" class="form-label">Sokak</label>
               <input id='sokak' type="text" name="sokak" placeholder="Sokak girin" class="form-control">
            </div>
            <div class="col">
               <label for="kapı" class="form-label">Bina No</label>
               <input type="text" name="kapı" placeholder="Yuvaya Yakın Bir Bina No" class="form-control">
            </div>
         </div>
         <div class="mt-4">
            <label for="acıklama" class="form-label">Açıklama</label>
            <input type="text" name="acıklama" placeholder="Kısaca yuvanın durumunu özetleyebilirsiniz" class="form-control">
         </div>
         
         <div class="mt-3"></div>
         <br>
         <input type="text" hidden name="lat" value="" id="lat">
         <input type="text" hidden name="lng" value="" id="lng">
         <button type="button" class="ml-5 btn btn-primary" id="go">Bildir</button>
         <br><br><br><br><br><br><br><br>
      </form>
   </div>
</div>
<script type="text/javascript">
   
   function validateForm() {
      var x = document.forms["form2"]["mahalle"].value;
      if (x == "") {
        alert("Mahalle adı girin!");
        return false;
      }
      var x = document.forms["form2"]["sokak"].value;
      if (x == "") {
        alert("Sokak adı girin!");
        return false;
      }
   }
   
   document.getElementById('go').addEventListener('click', () => {
   var il = document.getElementById('il').value;
   var ilce = document.getElementById('ilce').value;
   var sokak = document.getElementById('sokak').value;


   fetch(`https://nominatim.openstreetmap.org/search?q=${sokak}+${il}&format=json&addressdetails=1`)
         .then(result => result.json())
         .then(parsedResult => {
            document.getElementById('lat').value=parsedResult[0]['lat'];
            document.getElementById('lng').value=parsedResult[0]['lon'];
         });
   });
//lat long varlığı kontrol edilip daha sonra rest-apiye bağlanacak bulunamazsa hata ekranı

   
</script>

{% endblock %}